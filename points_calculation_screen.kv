<PointsCalculationScreen>
    name: "PointsCalculationScreen"

    AnchorLayout:
        id: outer_centering_box
        anchor_x: "center"
        anchor_y: "center"
        canvas:
            Color:
                rgba: app.background_color
            Rectangle:
                pos: self.pos
                size: self.size

        BorderedBoxLayout:
            id: main_box
            orientation: "vertical"
            size_hint: .95, .98

            BorderedBoxLayout:
                id: header_box
                orientation: "horizontal"
                size_hint: 1, 0.10

                AnchorLayout:
                    id: spare_place_box
                    anchor_x: "center"
                    anchor_y: "center"
                    size_hint: .3, 1

                    Button:
                        id: change_color_theme_button
                        size_hint: .5, .6
                        on_press: root.change_color_theme()
                        background_normal: app.theme_icon
                        border: 0, 0, 0, 0

                Label:
                    id: header_text
                    text: "[b]Подсчёт очков[/b]"
                    font_size: 25
                    markup: True
                    color: app.text_color

                AnchorLayout:
                    id: rating_button_box
                    anchor_x: "center"
                    anchor_y: "center"
                    size_hint: .3, 1

                    Button:
                        id: to_players_rating_screen_button
                        size_hint: .7, .65
                        on_press: root.to_players_rating_screen()
                        background_normal: app.rating_icon
                        background_down:'img/rating_icon_black.png'
                        border: 0, 0, 0, 0


            TabbedPanel:
                id: players_tabbed_panel
                do_default_tab: False

                BorderedTabbedPanelItem:
                    id: first_player_tab
                    text: 'Игрок\n1'

                    PlayerTab:
                        id: first_player_tab_box

                BorderedTabbedPanelItem:
                    id: second_player_tab
                    text: 'Игрок\n2'

                    PlayerTab:
                        id: second_player_tab_box

                BorderedTabbedPanelItem:
                    id: third_player_tab
                    text: 'Игрок\n3'

                    PlayerTab:
                        id: third_player_tab_box

                BorderedTabbedPanelItem:
                    id: fourth_player_tab
                    text: 'Игрок\n4'

                    PlayerTab:
                        id: fourth_player_tab_box

                BorderedTabbedPanelItem:
                    id: fifth_player_tab
                    text: 'Игрок\n5'

                    PlayerTab:
                        id: fifth_player_tab_box


            BorderedBoxLayout:
                id: menu_buttons_box
                orientation: "horizontal"
                size_hint: 1, 0.07

                BorderedButton:
                    id: save_button
                    text: "Сохранить"
                    on_press: root.save_game_data()

                BorderedButton:
                    id: history_button
                    text: "История"
                    on_press: root.to_games_history_screen()

                BorderedButton:
                    background_down: 'img/pressed.png'
                    id: erase_button
                    text: "Стереть"


<PlayerTab>
    BoxLayout:
        id: tab_main_box
        orientation: "vertical"
        canvas:
            Color:
                rgba: app.background_color
            Rectangle:
                pos: self.pos
                size: self.size

        BorderedBoxLayout:
            id: first_inputs_box
            orientation: "horizontal"
            size_hint: 1, 0.15

            canvas:
                Color:
                    rgb: app.text_color
                Rectangle:
                    pos: self.x, self.y - 80
                    size: self.width, self.height * 2.5

                Color:
                    rgb: app.background_color
                Rectangle:
                    pos: self.x + dp(1), self.y - 80 + dp(1)
                    size: self.width - dp(2), self.height * 2.5 - dp(2)

            BoxLayout:
                id: player_name_box
                orientation: "vertical"

                Label:
                    id: player_name_text
                    text: "Имя:"
                    color: app.text_color

                AnchorLayout:
                    id: player_name_centring_box
                    anchor_x: "center"
                    anchor_y: "center"

                    TextInput:
                        id: player_name_input
                        halign: "center"
                        multiline: False
                        size_hint: .9, 1.1
                        font_size: 18
                        on_text: root.change_tab_name(self.text)

            AnchorLayout:
                id: clear_player_button_box
                anchor_x: "center"
                anchor_y: "bottom"
                size_hint: .2, 1

                Button:
                    id: clear_player_button
                    background_normal: app.close_icon
                    background_down:'img/close_pressed.png'
                    border: 0, 0, 0, 0
                    size_hint: .65, .7
                    font_size: 25
                    halign: "center"
                    valign: "top"
                    text_size: self.size
                    # on_press: root.print_children()
                    on_press: root.clear_player_info()

        BoxLayout:
            id: second_inputs_box
            orientation: "vertical"
            size_hint: 1, 0.22

            BoxLayout:
                id: second_inputs_inner_box
                orientation: "horizontal"

                BoxLayout:
                    id: normal_points_box
                    orientation: "vertical"

                    Label:
                        id: normal_points_text
                        text: "Обычные очки:"
                        color: app.text_color

                    AnchorLayout:
                        id: normal_points_centring_box
                        anchor_x: "center"
                        anchor_y: "center"

                        TextInput:
                            id: normal_points_input
                            hint_text: "0"
                            halign: "center"
                            multiline: False
                            size_hint: .9, 1
                            font_size: 18
                            on_text: root.calculate_result()
                            # on_parent: root.build_category_blocks()

                BoxLayout:
                    id: empire_cards_box
                    orientation: "vertical"

                    Label:
                        id: empire_cards_text
                        text: "Карта империи:"
                        color: app.text_color

                    AnchorLayout:
                        id: empire_cards_centring_box
                        anchor_x: "center"
                        anchor_y: "center"

                        DropDown:
                            id: empire_cards_dropdowm

            Label:
                id: normal_points_result_text
                text: "0"
                size_hint: 1, 0.3
                color: app.text_color

        GridLayout:
            id: category_grid_box
            cols: 2

            CategoryBlock
            CategoryBlock
            CategoryBlock
            CategoryBlock
            CategoryBlock
            CategoryBlock

        BorderedLabel:
            id: final_result_text
            text: "Результат: 0"
            halign: "center"
            valign: "top"
            size_hint: 1, 0.1
            text_size: self.size
            font_size: 22
            color: app.text_color


<CategoryBlock@AnchorLayout>
    id: category_centring_box
    anchor_x: "center"
    anchor_y: "center"

    BoxLayout:
        id: category_main_box
        orientation: 'vertical'
        size_hint: .9, .9

        AnchorLayout:
            id: category_image_box
            anchor_x: "center"
            anchor_y: "center"

            Image:
                id: category_image
                # source: f'img/{self.categories_names_list[0]}.png'

        BoxLayout:
            id: category_inputs_box
            orientation: 'horizontal'

        Label:
            text: "0"
            size_hint: 1, .3


<NormalCategoryInputs@BoxLayout>
    TextInput:
        hint_text: "0"
        halign: center
        multiline: False
        size_hint: .8, .7
        font_size: 20
        on_text: root.calculate_result

    Label:
        text: "x"
        size_hint: .5, .9
        font_size: 20

    TextInput:
        hint_text: "0"
        halign: center
        multiline: False
        size_hint: .8, .7
        font_size: 20
        on_text: root.calculate_result


<LastCategoryInputs@BoxLayout>
    TextInput:
        hint_text: "0"
        halign: center
        multiline: False
        size_hint: .8, .7
        font_size: 20
        on_text: root.calculate_result

    Label:
        text: "x ("
        size_hint: .6, .9
        font_size: 20

    TextInput:
        hint_text: "0"
        halign: center
        multiline: False
        size_hint: .8, .7
        font_size: 20
        on_text: root.calculate_result

    Label:
        text: " + 1)"
        size_hint: .5, .9
        font_size: 20


<BorderedBoxLayout@BoxLayout>
    canvas:
        Color:
            rgba: app.text_color
        Rectangle:
            pos: self.pos
            size: self.size

        Color:
            rgba: app.background_color
        Rectangle:
            pos: self.x + dp(1), self.y + dp(1)
            size: self.width - dp(2), self.height - dp(2)


<BorderedTabbedPanelItem@TabbedPanelItem>
    canvas:
        Color:
            rgba: app.text_color
        Rectangle:
            pos: self.pos
            size: self.size

        Color:
            rgba: app.background_color if self.state=='normal' else app.background_pressed
        Rectangle:
            pos: self.x + dp(1), self.y + dp(1)
            size: self.width - dp(2), self.height - dp(2)

        Color:
            rgba: app.text_color
        Rectangle:
            texture: self.texture
            pos: int(self.center_x - self.texture_size[0] / 2), int(self.center_y - self.texture_size[1] / 2)
            size: self.texture_size


<BorderedLabel@Label>
    canvas:
        Color:
            rgba: app.text_color
        Rectangle:
            pos: self.pos
            size: self.size

        Color:
            rgba: app.background_color
        Rectangle:
            pos: self.x + dp(1), self.y + dp(1)
            size: self.width - dp(2), self.height - dp(2)

        Color:
            rgba: app.text_color
        Rectangle:
            texture: self.texture
            pos: int(self.center_x - self.texture_size[0] / 2), int(self.center_y - self.texture_size[1] / 2)
            size: self.texture_size


<BorderedTextInput@TextInput>
    canvas:
        Color:
            rgba: app.text_color
        Rectangle:
            pos: self.pos
            size: self.size

        Color:
            rgba: app.background_color
        Rectangle:
            pos: self.x + dp(1), self.y + dp(1)
            size: self.width - dp(2), self.height - dp(2)

<BorderedButton@Button>
    canvas:
        Color:
            rgba: app.text_color
        Rectangle:
            pos: self.pos
            size: self.size

        Color:
            rgba: app.background_color if self.state=='normal' else app.background_pressed
        Rectangle:
            pos: self.x + dp(1), self.y + dp(1)
            size: self.width - dp(2), self.height - dp(2)

        Color:
            rgba: app.text_color
        Rectangle:
            texture: self.texture
            pos: int(self.center_x - self.texture_size[0] / 2), int(self.center_y - self.texture_size[1] / 2)
            size: self.texture_size
